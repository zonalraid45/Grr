name: List running workflows of Lichessbotli

on:
  workflow_dispatch: # run manually

jobs:
  list:
    runs-on: ubuntu-latest

    steps:
      - name: List running workflows
        env:
          TOKEN: ${{ secrets.EXO }} # use your same GitHub token
          USER: "Lichessbotli"
        run: |
          echo "Fetching repositories for $USER..."
          # Get list of repos for the user
          repos=$(curl -s -H "Authorization: token $TOKEN" \
            "https://api.github.com/users/$USER/repos?per_page=100" | jq -r '.[].name')

          for repo in $repos; do
            echo "----- Checking $repo -----"
            runs=$(curl -s -H "Authorization: token $TOKEN" \
              "https://api.github.com/repos/$USER/$repo/actions/runs?status=in_progress&per_page=5" | jq -r '.workflow_runs[]?.name')
            if [ -z "$runs" ]; then
              echo "No workflows running in $repo"
            else
              echo "Running workflows in $repo:"
              echo "$runs"
            fi
          done
